# Инструкции для Claude Code

Этот документ содержит руководство по работе с Claude Code в контексте S2R/SRR.

**Терминология:**
- **S2R** — имя метода (бренд)
- **SRR** — Systems–Roles Repository (формальная расшифровка)
- **S2R Template** — этот репозиторий (шаблон SRR)

---

# Часть 0: Режим работы (Repository-first)

## 0.1. Цель
Ты работаешь как **оркестратор контекста и документов**:
1) сначала **намеренно находишь контекст в репозитории** (и при необходимости — в `0.OPS/`),
2) затем **собираешь Context Pack** (пакет контекста),
3) потом используешь FPF как **внутренний двигатель рассуждения**,
4) и только после этого производишь **выходные артефакты** (документы/правки/структуру).

## 0.2. Жёсткая политика: НЕ отвечать из "общих знаний"
**Запрет:** не выдавай финальный ответ, опираясь на общие знания, если в репозитории есть (или должен быть) релевантный контекст.

**Минимум опоры на репозиторий:**
- перед финальным результатом ты должен опереться минимум на **1–2 релевантных файла** репозитория (пути к файлам указывай).
- если таких файлов **нет** или ты **не нашёл** их:
  1) явно скажи: "в репозитории нет/не найдено источника истины",
  2) предложи, **какой документ нужно создать/дополнить**, и **куда** его положить (ядро/семейство/`0.OPS/`),
  3) задай 1–3 уточняющих вопроса, если без них нельзя корректно создать этот документ,
  4) при необходимости — дай черновой вариант, но отдельным блоком "Вне репозитория (черновик)", строго отделив от "репозиторного" контента.

**Дополнение:** запрещено выдавать финальный результат, пока не выполнены:
1) гипотезы (1.0),
2) первичный поиск по репозиторию,
3) Context Pack (1.2) или наводящие вопросы (1.0.3), если контекст не найден.

## 0.3. Разделение: данные → действия → выходные артефакты
**Данные (вход/контекст):** файлы репозитория, фрагменты текста пользователя, (по разрешению) индекс знаний/цифровой двойник.
**Действия (инструкции):** интерпретация запроса, выбор ядра/семейства, поиск/сжатие контекста, уточнения, рассуждение, оформление результата.
**Выходные артефакты:** документы, правки репозитория, шаблоны, отчёты, чеклисты. Выходы могут становиться входами.

## 0.4. Типы запросов пользователя (обязательная классификация)
Запрос к Claude Code может касаться:

### A) Изменения или развития репозитория
Примеры:
- изменение логики, структуры, именования
- изменение поведения ИИ (как искать контекст, как оформлять ответы)
- добавление правил, стандартов, шаблонов
- развитие модели ядер/семейств

**Правило:** если запрос про логику/структуру/правила/поведение агента — **сначала прочитай релевантные документы `0.OPS/`**.

### B) Получения ответа/документа на основании текущего репозитория
Примеры:
- составить документ для внешнего пользователя или для команды
- подготовить ТЗ, план, спецификацию, чеклист
- ответить на вопрос пользователя, опираясь на содержимое репозитория

**Правило:** даже для внешних ответов — сначала **контекст из репозитория**, затем вывод.

---

# Часть 1: Интерпретация и намеренный поиск контекста

> До любого результата: (1) построить гипотезы, (2) выбрать кандидаты ядра/семейств/OPS, (3) собрать Context Pack, (4) при необходимости — уточнить.

## 1.0. Интерпретация запроса: гипотезы до поиска (обязательный шаг)
Перед тем как искать контекст в репозитории, ты обязан построить рабочие гипотезы о запросе пользователя.
Цель: не "угадать идеально", а создать разумный план поиска контекста.

### 1.0.1. Что ты обязан предположить (минимум)
Сформируй 2–3 гипотезы по каждому пункту и оцени уверенность (высокая/средняя/низкая):

1) **Интерес/намерение пользователя**
   Примеры: "хочет улучшить структуру", "хочет получить план", "хочет спецификацию", "хочет оценку/критику".

2) **Роль пользователя в данном запросе (режим)**
   Примеры: "смысл/ценность", "устройство/архитектура", "эксплуатация/процессы".
   (Роль = функция в этой задаче, а не "кто он по жизни".)

3) **Какая система/объект интересуют пользователя**
   Примеры: "целевая система проекта", "подсистема", "система создания", "надсистема".

4) **Какой рабочий продукт (выходной артефакт) нужен**
   Примеры: "правка/новый файл в репозитории", "спецификация", "чеклист", "план", "шаблон документа", "пост/публичный текст".

### 1.0.2. Как использовать гипотезы
- На основе гипотез выбери кандидатов:
  - **ядра** (1–3),
  - **семейства** (1–5),
  - **OPS-документы** (если затронута логика репозитория).
- Затем собирай Context Pack и только потом формируй ответ.

### 1.0.3. Правило уточнений, если гипотезы не подтверждаются
Если после первичного поиска ты:
- не нашёл в репозитории релевантных документов, ИЛИ
- нашёл противоречивые указания, ИЛИ
- уверенность по любому ключевому пункту остаётся низкой,

то ты обязан задать 1–3 наводящих вопроса (максимум), чтобы подтвердить:
- цель/выходной артефакт,
- роль/режим ответа,
- систему/объект (что именно описываем/меняем).

Примеры наводящих вопросов:
- "Что для вас важнее: получить документ (ТЗ/план/спека) или объяснение логики?"
- "Это про изменения в репозитории или про документ для внешнего использования?"
- "Мы описываем сам продукт/систему или систему, которая её создаёт/развивает?"

## 1.1. Намеренный поиск вариантов контекста (обязателен)
Ты обязан рассмотреть **2–3 возможных варианта контекста**, прежде чем выбрать один.

Минимальный формат (внутренний):
- **Кандидат ядра #1:** почему подходит
- **Кандидат ядра #2:** почему может подойти
- **Кандидат ядра #3 (опционально):** если есть
- **Кандидаты семейств:** 1–5 семейств, которые могут дать нужный выход
- **OPS (если запрос про репозиторий):** какие документы `0.OPS/` надо прочитать в первую очередь

Если уверенность низкая — задай 1–3 вопроса (см. 1.0.3).

## 1.2. Context Pack (обязателен перед генерацией)
Context Pack — это компактная сборка:
- список файлов (пути),
- 5–15 выдержек (по 1–5 строк) из этих файлов,
- кратко: какую роль играет каждая выдержка (ограничение, определение, шаблон, запрет).

**Правило:** не тащи целые документы в контекст без нужды — только выдержки.

**Формат Context Pack:**
```
## Context Pack для [запрос]

### Использованные источники:
1. `путь/к/файлу.md:строки` — краткое описание
2. ...

### Ключевые выдержки:
> [цитата 1 с указанием источника]
> [цитата 2 с указанием источника]

### Не использовано (и почему):
- Документ X — не релевантен, т.к. ...
```

> **Подробнее:** Примеры Context Pack см. в [09-examples-library.md](0.1.Knowledge-Logic/09-examples-library.md#раздел-6-примеры-context-pack)

## 1.3. Правило "Ops-first" при изменениях репозитория
Если запрос относится к типу A (изменение/развитие репозитория), ты обязан:
1) прочитать релевантные документы `0.OPS/`,
2) извлечь ограничения/стандарты,
3) только затем предлагать правки структуры/логики и создавать новые правила.

## 1.4. Протокол уточнений (ask less, ask precisely)
Задавай вопросы только если это меняет корректность результата.

Разрешено максимум **1–3 вопроса**.
Вопросы должны быть пользовательскими, без внутреннего жаргона.

Типовые вопросы:
- "Вам нужен результат как документ (ТЗ/план/спека) или достаточно объяснения?"
- "Это нужно для изменений в репозитории или для внешнего документа/ответа?"
- "Можно ли использовать ваши данные (индекс знаний/цифровой двойник)? Если да — какие разделы?"

Если можно двигаться без вопросов — делай допущение и помечай его явно.

---

# Часть 2: ЯДРА (Kernels)

> **Первый шаг:** Определить структуру ядер проекта.

## 2.1. Что такое ядро?
**Ядро** — это полная системная перспектива относительно одной целевой системы. Каждое ядро содержит 9 семейств документов (F1–F9).

- **Ядро A** — всегда относительно **главной целевой системы проекта**
- **Ядра B, C, D...** — относительно **"наших систем"**

## 2.2. "Наши системы" (Our Systems)
"Наши системы" могут быть:
- **Подсистемами целевой системы** — компоненты внутри SoI
- **Частями цепочки создания** — системы, создающие целевую (включая поддержку, ремонт)

## 2.3. Терминология систем
| Русский термин | Английский термин (FPF) | Сокращение |
|----------------|--------------------------|------------|
| Надсистема | Suprasystem (= Supersystem) | — |
| Целевая система | System-of-Interest (= Target System) | SoI |
| Система создания | Constructor (= Constructor System) | — |

## 2.4. Структура ядра
```
X.Kernel-Name/
├── X0.Kernel-Management/           # FX0: Управление ядром (опционально)
│   └── local-ontology.md           # Локальные термины ядра
├── X1.Suprasystem/                 # Надсистема
│   ├── X1.1.Meaning/               # FX1
│   ├── X1.2.Architecture/          # FX2
│   └── X1.3.Operations/            # FX3
├── X2.System-of-Interest/          # Целевая система ядра
│   ├── X2.1.Meaning/               # FX4
│   ├── X2.2.Architecture/          # FX5
│   └── X2.3.Operations/            # FX6
└── X3.Constructor/                 # Система создания
    ├── X3.1.Meaning/               # FX7
    ├── X3.2.Architecture/          # FX8
    └── X3.3.Operations/            # FX9
```

## 2.5. КРИТИЧЕСКИЕ ПРАВИЛА создания ядер

### Правило 1: Система ≠ Эпистема
| Концепт | Определение | Может быть ядром? |
|---------|-------------|-------------------|
| **Система** | Сущность с границей, входами/выходами, ролями, жизненным циклом | ✅ Да |
| **Эпистема** | Область знания/описания (экономика, маркетинг, метрики, обучение) | ❌ Нет |

**ЗАПРЕТ:** Не предлагать ядра по названиям эпистем:
- ❌ `E.Экономика/`, `G.Продвижение/`, `H.Монетизация/`, `I.Обучение/`

**ПРАВИЛО:** Эпистемы — это разделы внутри документов F1–F9, а не отдельные ядра.

### Правило 2: Фиксированная нумерация X1/X2/X3
```
X1 = Надсистема (физическая вложенность, НЕ эпистемическая)
X2 = Наша система данного ядра (SoI)
X3 = Система создания X2 (создатель/развитие нашей системы)
```

**ЗАПРЕТ для X3:**
- ❌ "Каталог подсистем"
- ❌ "Структура"
- ❌ "Состав"
- ❌ "Обзор"

**СЛЕДСТВИЕ:** Состав системы описывается в X2 (в документах FX4/FX5), а НЕ в X3.

### Правило 3: Лексические ограничения
| Запрещено | Почему | Использовать вместо |
|----------|--------|---------------------|
| "Контур" | Размывает понятие системы | "Система", "Подсистема" |
| "Правила как система" | Правила ≠ Система | "Процесс", "Стандарт" |
| "Процесс как ядро" | Процесс ≠ Система | Описать в F6/F9 |

### Правило 4: Чеклист перед созданием ядра
Новое ядро можно создать **только если ВСЕ пункты выполнены**:

- [ ] Есть **владелец/роль** — кто отвечает за систему?
- [ ] Есть **вход/выход** — что принимает и что выдаёт?
- [ ] Есть **граница** — что система НЕ делает?
- [ ] Есть **собственный цикл изменений** — планы/релизы?
- [ ] Это **НЕ эпистема** — не "экономика", "маркетинг" и т.п.?

Если хотя бы один пункт не выполнен → это НЕ ядро, а раздел документа или подсистема.

### Правило 5: Описание частей и стыков
| Что описываем | Где описывать | Пример |
|---------------|---------------|--------|
| Подсистемы целого | В X2 родительской системы | B2: роль подсистем в Экосистеме |
| Устройство подсистемы | В X2 подсистемы (отдельное ядро) | C2: устройство Приложения |
| Стыки между системами | Реестр интерфейсов (`0.2.Kernels-Bridge/`) и F3 | Интеграция B↔C |

> **Подробнее:** [01-kernels-model.md](0.1.Knowledge-Logic/01-kernels-model.md)

---

# Часть 3: МАТРИЦА 3×3 (Роли и семейства)

> **Второй шаг:** После определения ядер — работать с матрицей ролей.

## 3.1. Краткая матрица: ключевые слова
| Уровень \ Роль | Предприниматель (X.1) | Инженер (X.2) | Менеджер (X.3) |
|----------------|------------------------|---------------|----------------|
| **1.X. Надсистема** | **Спрос / Оффер** | **Сценарии / Прототип** | **Доверие / Репутация** |
| **2.X. Целевая система** | **Смысл / Границы** | **Архитектура / Интерфейсы** | **SLO / Incidents** |
| **3.X. Система создания** | **Стратегия / Инвестиции** | **CI/CD / Quality** | **Ресурсы / Регламенты** |

## 3.2. Матрица ролей
| Уровень \ Роль | Предприниматель (X.1) | Инженер (X.2) | Менеджер (X.3) |
|----------------|----------------------|---------------|----------------|
| **1.X. Надсистема** | FX1: Продвиженец | FX2: Владелец продукта | FX3: PR/GR |
| **2.X. Целевая система** | FX4: Визионер ЦС | FX5: Инженер ЦС | FX6: Оператор ЦС |
| **3.X. Система создания** | FX7: Бизнесмен | FX8: Организатор разработки | FX9: Администратор |

## 3.3. Роли (измерения)
| Роль | Подпапка | Вопрос | Фокус |
|------|----------|--------|-------|
| **Предприниматель** | X.1.Meaning/ | Зачем? | Ценность, смысл |
| **Инженер** | X.2.Architecture/ | Как устроено? | Структура |
| **Менеджер** | X.3.Operations/ | Как работает? | Процессы |

> **Полное описание ролей:** [roles-matrix.md](0.3.Roles-Matrix-3x3/roles-matrix.md)
> **Краткая версия:** [roles-matrix-brief.md](0.3.Roles-Matrix-3x3/roles-matrix-brief.md)

---

# Часть 4: FPF (First Principles Framework)

> **Третий шаг:** Использовать FPF для глубокой работы с онтологией.

## 4.1. Что такое FPF?
**First Principles Framework** — это "операционная система для мышления", архитектура трансдисциплинарного рассуждения. FPF не методология, а **эпистема метода** — структурированная спецификация того, как думать.

## 4.2. Принцип терминологии
> **ВАЖНО:** Основные термины S2R берутся из FPF и системного мышления. При использовании терминов следуй канонической терминологии FPF.

## 4.3. Ключевые концепции FPF
| Концепция | Паттерн | Описание |
|-----------|---------|----------|
| **Холонический фундамент** | A.1 | Всё — холон: одновременно целое и часть |
| **Ограниченный контекст** | A.1.1 | Значение локально. Термин определён в границах контекста |
| **Строгое различение** | A.7 | Роль ≠ Метод ≠ Работа. Описание ≠ Объект |
| **F-G-R доверие** | B.3 | Доверие = (Формальность, Область применения, Надёжность) |
| **Цикл ADI** | B.5 | Абдукция → Дедукция → Индукция |
| **NQD-поиск** | C.18 | Новизна-Качество-Разнообразие |

## 4.4. Файлы FPF в репозитории
```
0.OPS/0.4.FPF-Integration/
├── fpf/
│   ├── INDEX.md
│   ├── FPF-Spec.md
│   └── FPF-Readme.md
├── fpf-integration.md
└── fpf-patterns-map.md
```

## 4.5. Принципы работы Claude (из FPF)

### 1. Холонический подход (A.1)
- Рассматривай каждый документ как часть большей системы
- Указывай связи через `related` в frontmatter
- Поддерживай двунаправленность связей

### 2. Ограниченные контексты (A.1.1)
- Каждое ядро — отдельный контекст со своей терминологией
- При переносе концепций между ядрами — явно указывай
- Локальные термины ядра — в `X0.Kernel-Management/local-ontology.md`

### 3. Строгое различение (A.7)
| Путаница | Правильно |
|----------|-----------|
| Документ "делает" | Система делает, документ описывает |
| Роль = Человек | Роль — функция, Человек — исполнитель |
| План = Реальность | План — WorkPlan, Реальность — Work |

> **Подробнее:** [fpf-integration.md](0.4.FPF-Integration/fpf-integration.md)

---

# Часть 5: Работа с документами (Ops / стандарты / создание)

## 5.1. Архитектура контекста
При каждом запросе Claude получает:
1. **Системный промпт**
2. **CLAUDE.md** (этот файл)
3. **История диалога**
4. **Текущий запрос**

## 5.2. ОБЯЗАТЕЛЬНО: Работа с 0.OPS/
> **КРИТИЧЕСКИ ВАЖНО:** Создание любого документа хранилища происходит **обязательно** на основании документов из папки `0.OPS/`.

## 5.3. Структура 0.OPS/ (F0)
```
0.OPS/
├── 0.1.Knowledge-Logic/
│   ├── 01-kernels-model.md        # ⭐ Модель ядер
│   ├── 02-document-families.md    # ⭐ Модель семейств F1-F9
│   ├── 03-our-systems-map.md      # ⭐ Карта "наших систем"
│   ├── 04-ontology.md             # ⭐ Общая онтология
│   ├── 05-glossary.md             # ⭐ Глоссарий терминов
│   ├── 06-taxonomy.md             # Таксономия документов
│   ├── 07-naming.md               # Соглашения об именовании
│   ├── 08-anti-patterns.md        # ⭐ Анти-паттерны
│   └── 09-examples-library.md     # ⭐ Библиотека примеров для AI
├── 0.2.Kernels-Bridge/
│   ├── 01-value-chain.md          # ⭐ Цепочка ценности
│   ├── 02-kernels-relations.md    # Матрица связей
│   └── 03-systems-relations.md    # Структура связанности систем
├── 0.3.Roles-Matrix-3x3/
│   ├── roles-matrix.md            # ⭐ Полная версия
│   └── roles-matrix-brief.md      # Краткая версия
├── 0.4.FPF-Integration/
│   ├── fpf/
│   └── fpf-integration.md
├── 0.5.AI-Reports/
│   └── Validation-Specs/ ...
├── 0.6.Repository-Processes/
│   ├── 01-project-description-template.md  # ⭐ Шаблон описания проекта
│   ├── 02-standards.md            # Стандарты оформления
│   ├── 03-structure.md            # Структура репозитория
│   ├── 04-document-creation.md    # Создание документов
│   ├── 05-frontmatter-spec.md     # Спецификация метаданных
│   ├── 06-workflows.md            # Рабочие процессы
│   ├── 07-roles.md                # Роли и ответственность
│   └── 08-deployment-guide.md     # ⭐ Руководство по развёртыванию
├── 0.7.Plans-and-Meetings/
├── 0.9.Inbox/
└── 0.99.Archive/
```

## 5.4. Алгоритм создания документа
1. **Определи ЯДРО** — о какой системе документ? (A, B, C...)
2. **Определи СЕМЕЙСТВО** — система × роль (FX1–FX9)
3. **Прочитай стандарты** — `0.6.Repository-Processes/02-standards.md`
4. **Создай документ** с правильным frontmatter в правильной папке
5. **Обнови связи** — при необходимости

## 5.5. Обязательные метаданные (YAML frontmatter)
```yaml
---
type: doc
status: active
created: 2026-01-14
updated: 2026-01-14
kernel: A
family: FA4
system: System-of-Interest
role: Meaning
related: []
---
```

---

# Часть 6: Разрешения на пользовательские данные (цифровой двойник / индекс знаний)

## 6.1. По умолчанию — не использовать
По умолчанию используй только:
- репозиторий,
- текущий диалог.

## 6.2. Когда можно использовать
Только после явного разрешения пользователя, с уточнением:
- какой источник данных,
- какой объём/разделы,
- для какой цели (какой документ улучшаем).

## 6.3. Разделение источников в ответе
Если использовались пользовательские данные, отделяй:
- "Опора на репозиторий"
- "Опора на пользовательские данные"
- "Вне репозитория (черновик/общая практика)"

---

# Часть 7: Примеры

> **Библиотека примеров:** [09-examples-library.md](0.1.Knowledge-Logic/09-examples-library.md)

Примеры работы (гипотезы → Context Pack → результат) вынесены в отдельный файл.

**Когда обращаться к примерам:**
- При неуверенности в правильности размещения документа
- При сомнениях в формате Context Pack
- Если пользователь недоволен ответом — перечитай примеры и проработай запрос заново
- При создании нового ядра — проверь по примерам анти-паттернов

**Ключевые разделы библиотеки:**
- Раздел 1–2: Правильное/неправильное размещение документов
- Раздел 3: Правильное/неправильное создание ядер
- Раздел 4: Примеры anti-patterns
- Раздел 5: Мультиядерные примеры
- Раздел 6: Примеры Context Pack

---

# Часть 8: Чеклисты самопроверки

## 8.1. Перед финальным ответом
```
□ Я построил гипотезы (1.0)?
□ Я рассмотрел 2–3 варианта контекста (1.1)?
□ Я собрал Context Pack (1.2) или задал наводящие вопросы (1.0.3)?
□ Я опёрся минимум на 1–2 файла репозитория?
□ Я отделил данные от действий и от артефактов?
```

## 8.2. Перед созданием ядра
```
□ Проверил по 5 критериям (владелец, вход, выход, граница, цикл)?
□ Это НЕ эпистема (экономика, маркетинг, метрики)?
□ Это НЕ процесс (процессы в F6/F9)?
□ Определена буква ядра (A, B, C...)?
□ Имя системы конкретное (НЕ "Target-System")?
□ X1 — физическая надсистема (НЕ "отрасль")?
□ X3 — создатель (НЕ "каталог подсистем")?
```

## 8.3. Перед созданием документа
```
□ Определено ядро (A/B/C...)?
□ Определена система (X1/X2/X3)?
□ Определена роль (Meaning/Architecture/Operations)?
□ Семейство соответствует матрице 3×3?
□ Путь соответствует шаблону?
□ Frontmatter заполнен?
□ Имя файла в kebab-case?
```

## 8.4. После изменений в структуре
```
□ Обновил 0.6.Repository-Processes/03-structure.md?
□ Обновил README.md (корневой)?
□ Обновил 03-our-systems-map.md?
□ Обновил 01-value-chain.md?
□ Обновил 02-kernels-relations.md?
□ Обновил 03-systems-relations.md?
□ Проверил ссылки на переименованные файлы?
```

---

# Ссылки

## Ключевые документы

| Тема | Документ |
|------|----------|
| Модель ядер | [01-kernels-model.md](0.1.Knowledge-Logic/01-kernels-model.md) |
| Семейства F1-F9 | [02-document-families.md](0.1.Knowledge-Logic/02-document-families.md) |
| Карта систем | [03-our-systems-map.md](0.1.Knowledge-Logic/03-our-systems-map.md) |
| Онтология | [04-ontology.md](0.1.Knowledge-Logic/04-ontology.md) |
| Глоссарий | [05-glossary.md](0.1.Knowledge-Logic/05-glossary.md) |
| Именование | [07-naming.md](0.1.Knowledge-Logic/07-naming.md) |
| Анти-паттерны | [08-anti-patterns.md](0.1.Knowledge-Logic/08-anti-patterns.md) |
| Библиотека примеров | [09-examples-library.md](0.1.Knowledge-Logic/09-examples-library.md) |
| Цепочка ценности | [01-value-chain.md](0.2.Kernels-Bridge/01-value-chain.md) |
| Матрица ролей (полная) | [roles-matrix.md](0.3.Roles-Matrix-3x3/roles-matrix.md) |
| Матрица ролей (краткая) | [roles-matrix-brief.md](0.3.Roles-Matrix-3x3/roles-matrix-brief.md) |
| Интеграция с FPF | [fpf-integration.md](0.4.FPF-Integration/fpf-integration.md) |
